mutate(across(
.cols = where(~ is.numeric(.) & is.na(.))
, ~ mean(.)
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(~ is.numeric(.) & is.na(.))
, ~ replace_na(replace = mean(.))
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(~ is.numeric(.) & is.na(.))
, ~ replace_na(replace = mean(., na.rm = T))
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(is.numeric(.) & is.na(.))
, ~ replace_na(replace = mean(., na.rm = T))
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(is.numeric(.) & is.na(.))
, ~ replace_na(replace = mean(., na.rm = T))
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(is.numeric(.) & is.na(.))
# , ~ replace_na(replace = mean(., na.rm = T))
, ~ 1
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(is.numeric(.x))
# , ~ replace_na(replace = mean(., na.rm = T))
, ~ ifelse(is.na(.x), yes = mean(.x, na.rm = T), no = .x)
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(is.numeric(.))
# , ~ replace_na(replace = mean(., na.rm = T))
, ~ ifelse(is.na(.x), yes = mean(.x, na.rm = T), no = .x)
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(~ is.numeric(.))
# , ~ replace_na(replace = mean(., na.rm = T))
, ~ ifelse(is.na(.x), yes = mean(.x, na.rm = T), no = .x)
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(~ is.numeric(.x))
, ~ ifelse(is.na(.x)
, yes = mean(.x, na.rm = T), no = .x)
))
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(~ is.numeric(.x))
, ~ ifelse(is.na(.x)
, yes = mean(.x, na.rm = T), no = .x)
)) %>% vis_miss(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>% qplot(GDP_PER_CAPITA_QUANTILE)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(is.na(GDP_PER_CAPITA_PPP),
yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>% qplot(.$GDP_PER_CAPITA_QUANTILE)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = mean(x, na.rm = T), no = x)}
)) %>% vis_miss(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
, GDP_PER_CAPITA_QUANTILE = factor(GDP_PER_CAPITA_QUANTILE)
) %>%
group_by(REGION, GDP_PER_CAPITA_QUANTILE) %>%
mutate(across(
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = mean(x, na.rm = T), no = x)}
)) %>% vis_miss(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>%
mutate(across(
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = mean(x, na.rm = T), no = x)}
)) %>% vis_miss(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
,quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
,include.lowest = T
,right = T
,na.rm = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>%
mutate(across(
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = mean(x, na.rm = T), no = x)}
)) %>% vis_miss(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T
, na.rm = T)
) %>% summary(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T
, na.rm = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>% select(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>% unique(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T
, na.rm = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>% select(REGION, GDP_PER_CAPITA_QUANTILE) %>% unique(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T
, na.rm = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>% select(REGION, GDP_PER_CAPITA_QUANTILE) %>% unique(.) %>% arrange(REGION)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>% select(REGION, GDP_PER_CAPITA_QUANTILE) %>% unique(.) %>% arrange(REGION)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>% select(REGION, GDP_PER_CAPITA_QUANTILE) %>% tally(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>%
mutate(across(
# NA'S nas colunas numéricas => média da região e do grupo (quantil) de renda per capita
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = mean(x, na.rm = T), no = x)}
)) %>%
group_by(REGION) %>% #Ainda restam alguns casos (coincidência de NA's em regiões e quantis de renda específicos)
mutate(across(
# NA'S nas colunas numéricas => média da região e do grupo (quantil) de renda per capita
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = mean(x, na.rm = T), no = x)}
)) %>% vis_miss(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>%
mutate(across(
# NA'S nas colunas numéricas => média da região e do grupo (quantil) de renda per capita
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = mean(x, na.rm = T), no = x)}
)) %>%
group_by(REGION) %>% #Ainda restam alguns casos (coincidência de NA's em regiões e quantis de renda específicos)
mutate(across(
# NA'S nas colunas numéricas => média da região e do grupo (quantil) de renda per capita
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = mean(x, na.rm = T), no = x)}
)) %>%
filter(is.na(GINI_INDEX)) %>% View(.)
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>%
mutate(across(
# NA'S nas colunas numéricas => mediana da região e do grupo (quantil) de renda per capita
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = median(x, na.rm = T), no = x)}
)) %>%
group_by(REGION) %>% #Ainda restam alguns casos (coincidência de NA's em regiões e quantis de renda específicos)
mutate(across(
# NA'S nas colunas numéricas => mediana da região e do grupo (quantil) de renda per capita
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = median(x, na.rm = T), no = x)}
)) %>%
ungroup(.) %>% #Ainda alguns pouquíssimos casos (Banco Mundial não disponibiliza o índice de GINI de uma região inteira)
mutate(across(
# NA'S nas colunas numéricas => mediana da coluna
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = median(x, na.rm = T), no = x)}
)) %>%
vis_miss(.)
# AJUSTES FINAIS (MISSING VALUES) -----------------------------------------
naniar::vis_miss(df.agg)
# Solução adotada: imputação da mediana
# Para adequar melhor os valores imputados, a mediana é calculada com base em grupos de países específicos
df.agg %>%
group_by(REGION) %>%
mutate(
GDP_PER_CAPITA_PPP = ifelse(
is.na(GDP_PER_CAPITA_PPP)
, yes = mean(GDP_PER_CAPITA_PPP, na.rm = T), no = GDP_PER_CAPITA_PPP)
, GDP_PER_CAPITA_QUANTILE = cut(
GDP_PER_CAPITA_PPP
, quantile(GDP_PER_CAPITA_PPP) #Quantis de renda per capita por região
, include.lowest = T
, right = T)
) %>%
group_by(REGION, factor(GDP_PER_CAPITA_QUANTILE)) %>%
mutate(across(
# NA'S nas colunas numéricas => mediana da região e do grupo (quantil) de renda per capita
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = median(x, na.rm = T), no = x)}
)) %>%
group_by(REGION) %>% #Ainda restam alguns casos (coincidência de NA's em regiões e quantis de renda específicos)
mutate(across(
# NA'S nas colunas numéricas => mediana da região e do grupo (quantil) de renda per capita
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = median(x, na.rm = T), no = x)}
)) %>%
ungroup(.) %>% #Ainda alguns pouquíssimos casos (Banco Mundial não disponibiliza o índice de GINI de uma região inteira)
mutate(across(
# NA'S nas colunas numéricas => mediana da coluna
.cols = where(~ is.numeric(.))
,.fns = function(x){ifelse(
is.na(x)
, yes = median(x, na.rm = T), no = x)}
)) -> df.agg
# AJUSTES FINAIS (MISSING VALUES) -----------------------------------------
naniar::vis_miss(df.agg) # Poucos Na's: cerca de 7% da base de dados
# PROBIT ------------------------------------------------------------------
df.agg %>%
select(
where(~ !is.factor(.))
, -c(CPI_RANK_2017, N_SOURCES_2017, STD_ERROR_2017
,WORLD_RANK, REGION_RANK, CPI_SCORE_2017)
) -> df.agg.probit
glm(data = df.agg.probit, formula = DUMMY_CPI ~ ., family = binomial(link = 'probit')) %>% summary(.)
glm(data = df.agg.probit, formula = DUMMY_CPI ~ ., family = binomial(link = 'probit')) -> lalala
lalala %>% coef(.) %>% exp(.)
